<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATE GATES | Medicine 3.0 Dashboard</title>
    <style>
        body { font-family: 'Courier New', Courier, monospace; background-color: #0f172a; color: #f8fafc; padding: 20px; }
        .container { max-width: 600px; margin: auto; border: 1px solid #334155; padding: 20px; background: #1e293b; border-radius: 8px; }
        h1 { color: #38bdf8; border-bottom: 2px solid #38bdf8; text-align: center; }
        .token-card { background: #334155; padding: 15px; margin: 10px 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .red { border-left: 5px solid #dc2626; }
        .blue { border-left: 5px solid #2563eb; }
        .gold { border-left: 5px solid #ca8a04; }
        .history { font-size: 0.8rem; color: #94a3b8; margin-top: 20px; max-height: 200px; overflow-y: auto; }
        button { width: 100%; padding: 10px; background: #38bdf8; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>STATE GATES: BIO-LOG</h1>
    <div id="status-update" style="text-align: center; padding: 10px; font-weight: bold; color: #fbbf24;"></div>
    
    <div id="dashboard">
        </div>

    <div class="history">
        <h3>LATEST CLINICAL EVENTS:</h3>
        <ul id="log-list"></ul>
    </div>
    
    <button onclick="localStorage.clear(); location.reload();">EMERGENCY SYSTEM RESET</button>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const cardID = urlParams.get('card');

    const cardLibrary = {
        "b_r1": { name: "Toe Yoga", cat: "Body", power: 2 },
        "b_b1": { name: "Zone 2 Walk", cat: "Body", power: 3 },
        // ... (Keep the rest of your library here)
    };

    // --- SMART LOGIC ---
    function processScan(id) {
        const now = Date.now();
        const lastScan = localStorage.getItem('last_scan_time_' + id);
        
        // 1. Prevent Double Scan (6-hour cooldown)
        if (lastScan && (now - lastScan) < (6 * 60 * 60 * 1000)) {
            alert("STAMINA DEPLETED: This tactic is already active. Wait 6 hours to bank again.");
            return;
        }

        // 2. Add Token with a CAP of 10
        let counts = JSON.parse(localStorage.getItem('gate_tokens') || "{}");
        let currentLevel = counts[id] || 0;
        
        if (currentLevel < 10) {
            counts[id] = currentLevel + 1;
            localStorage.setItem('gate_tokens', JSON.stringify(counts));
            localStorage.setItem('last_scan_time_' + id, now);
            alert("BATTERY CHARGED: " + cardLibrary[id].name + " logged.");
        } else {
            alert("MAX CAPACITY: You are fully optimized in this tactic!");
        }
    }

    // --- DAILY DECAY (Run every time she opens the app) ---
    function applyDecay() {
        const lastDecay = localStorage.getItem('last_decay_date');
        const today = new Date().toDateString();

        if (lastDecay !== today) {
            let counts = JSON.parse(localStorage.getItem('gate_tokens') || "{}");
            for (let id in counts) {
                counts[id] = Math.max(0, counts[id] - 1); // Drop by 1, min 0
            }
            localStorage.setItem('gate_tokens', JSON.stringify(counts));
            localStorage.setItem('last_decay_date', today);
        }
    }

    if (cardID && cardLibrary[cardID]) {
        processScan(cardID);
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    applyDecay();
    renderDashboard(); // Assuming you have a render function
</script>
</body>
</html>

